# Docker Compose Híbrido - PostgreSQL nativo + Contenedores Windows
# PostgreSQL instalado en el host, Backend y Frontend containerizados
#
# IMPORTANTE: host.docker.internal funciona automáticamente en Docker Desktop
# Para Docker Engine puro, usar la IP del host (ej: 192.168.1.100)

services:
  # Backend FastAPI (Windows Container)
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.windows
    container_name: vehiculos-backend
    ports:
      - '3035:3035'
    environment:
      # Conectar a PostgreSQL en el host
      # OPCIÓN 1: host.docker.internal (funciona con Docker Desktop)
      # OPCIÓN 2: IP del host (ej: 192.168.1.100) si falla host.docker.internal
  DATABASE_URL: postgresql://postgres:yourpassword@172.29.208.1:5432/vehiculos_operacion
      SECRET_KEY: your-secret-key-here-change-in-production
      ALGORITHM: HS256
      ACCESS_TOKEN_EXPIRE_MINUTES: 30
      UPLOAD_DIR: uploads
    volumes:
      - backend_uploads:c:/app/uploads
    # extra_hosts solo necesario si host.docker.internal no funciona
    extra_hosts:
      - "host.docker.internal:172.29.208.1"
    networks:
      - vehiculos-network

  # Frontend Next.js (Windows Container)
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.windows
      args:
        NEXT_PUBLIC_API_URL: http://localhost:3035
    container_name: vehiculos-frontend
    ports:
      - '8036:8035'
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:3035
      NODE_ENV: production
    depends_on:
      - backend
    networks:
      - vehiculos-network

networks:
  vehiculos-network:
    driver: nat

volumes:
  backend_uploads:
